<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pnpm+workspace+changesets构建monorepo工程 | JR-Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around.">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.318df977.css" as="style"><link rel="preload" href="/myblog/assets/js/app.e537f6cf.js" as="script"><link rel="preload" href="/myblog/assets/js/2.1acd9fc1.js" as="script"><link rel="preload" href="/myblog/assets/js/3.3d28f0c8.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.00af6b8a.js"><link rel="prefetch" href="/myblog/assets/js/11.311509a4.js"><link rel="prefetch" href="/myblog/assets/js/12.c754f8a6.js"><link rel="prefetch" href="/myblog/assets/js/13.4cb3dc3b.js"><link rel="prefetch" href="/myblog/assets/js/14.29c7e94d.js"><link rel="prefetch" href="/myblog/assets/js/15.f46e4d37.js"><link rel="prefetch" href="/myblog/assets/js/16.efaba0c7.js"><link rel="prefetch" href="/myblog/assets/js/17.b69d9adf.js"><link rel="prefetch" href="/myblog/assets/js/4.78d7c9d5.js"><link rel="prefetch" href="/myblog/assets/js/5.f4c66f27.js"><link rel="prefetch" href="/myblog/assets/js/6.d5069eb1.js"><link rel="prefetch" href="/myblog/assets/js/7.28162aa8.js"><link rel="prefetch" href="/myblog/assets/js/8.394493cb.js"><link rel="prefetch" href="/myblog/assets/js/9.deedd640.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.318df977.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">JR-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><!----> <span class="title" style="display:;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/5ea030/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/a88ea4/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/a88ea4/404" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/51014f/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/" class="nav-link">前端工程</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/97fe03/" class="nav-link">前端组件库</a></li></ul></div></div><div class="nav-item"><a href="/myblog/pages/a88ea4/404" class="nav-link">工作</a></div><div class="nav-item"><a href="/myblog/pages/a88ea4/404" class="nav-link">生活</a></div> <a href="https://github.com/jiang-gary/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><!----> <span class="title" style="display:;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/5ea030/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/a88ea4/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/a88ea4/404" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/51014f/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/" class="nav-link">前端工程</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/97fe03/" class="nav-link">前端组件库</a></li></ul></div></div><div class="nav-item"><a href="/myblog/pages/a88ea4/404" class="nav-link">工作</a></div><div class="nav-item"><a href="/myblog/pages/a88ea4/404" class="nav-link">生活</a></div> <a href="https://github.com/jiang-gary/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>手写系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/5ea030/" class="sidebar-link">实现call,apply,bind</a></li><li><a href="/myblog/pages/db05f4/" class="sidebar-link">实现Promise</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/14dc86/" class="sidebar-link">原型-原型链-继承</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/51014f/" class="sidebar-link">webview使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/a88ea4/" aria-current="page" class="active sidebar-link">pnpm+workspace+changesets构建monorepo工程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#什么是-monorepo" class="sidebar-link">什么是 monorepo？</a></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#什么是-pnpm-的-workspace" class="sidebar-link">什么是 pnpm 的 workspace</a></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#什么是-changesets" class="sidebar-link">什么是 Changesets</a></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#为什么要使用-changesets" class="sidebar-link">为什么要使用 Changesets</a></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#使用-pnpm-搭建-monorepo-工程" class="sidebar-link">使用 pnpm 搭建 monorepo 工程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#安装-pnpm" class="sidebar-link">安装 pnpm</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#工程初始化" class="sidebar-link">工程初始化</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#配置-pnpm-的-workspace" class="sidebar-link">配置 pnpm 的 workspace</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#配置安装-changesets-init" class="sidebar-link">配置安装 changesets （init）</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#使用添加新的-changesets-add" class="sidebar-link">使用添加新的 changesets (add)</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#使用-changeset-发布变更-version" class="sidebar-link">使用 changeset 发布变更 （version）</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#项目工程化相关" class="sidebar-link">项目工程化相关</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#安装-husky-与-commitlint" class="sidebar-link">安装 husky 与 commitlint</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/a88ea4/#changesets-的使用" class="sidebar-link">Changesets 的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#changset-的添加" class="sidebar-link">changset 的添加</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/a88ea4/#changeset-的发布" class="sidebar-link">changeset 的发布</a></li></ul></li></ul></li><li><a href="/myblog/pages/209fb8/" class="sidebar-link">husyk+commitlint配置提交代码检查与规范</a></li><li><a href="/myblog/pages/d96e68/" class="sidebar-link">standard-version版本自动化工具</a></li><li><a href="/myblog/pages/d03de6/" class="sidebar-link">前端单元测试</a></li><li><a href="/myblog/pages/1b7d18/" class="sidebar-link">Babel认识与应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端组件库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/97fe03/" class="sidebar-link">搭建Taro3组件库</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-e1efabd0><div class="articleInfo" data-v-e1efabd0><ul class="breadcrumbs" data-v-e1efabd0><li data-v-e1efabd0><a href="/myblog/" title="首页" class="iconfont icon-home router-link-active" data-v-e1efabd0></a></li> <li data-v-e1efabd0><span data-v-e1efabd0>学习</span></li><li data-v-e1efabd0><span data-v-e1efabd0>前端工程</span></li></ul> <div class="info" data-v-e1efabd0><div title="作者" class="author iconfont icon-touxiang" data-v-e1efabd0><a href="https://github.com/jiang-gary" target="_blank" title="作者" class="beLink" data-v-e1efabd0>Jiang Rui</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-e1efabd0><a href="javascript:;" data-v-e1efabd0>2022-09-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">pnpm+workspace+changesets构建monorepo工程<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="什么是-monorepo"><a href="#什么是-monorepo" class="header-anchor">#</a> 什么是 monorepo？</h2> <p>什么是<code>monorepo</code>？以及和 <code>multirepo</code> 的区别是什么?</p> <p>简而言之，<code>monorepo</code> 就是把多个工程放到一个 <code>git</code> 仓库中进行管理，因此他们可以共享同一套构建流程、代码规范也可以做到统一，特别是如果存在模块间的相互引用的情况，查看代码、修改 bug、调试等会更加方便。</p> <h2 id="什么是-pnpm-的-workspace"><a href="#什么是-pnpm-的-workspace" class="header-anchor">#</a> 什么是 pnpm 的 <a href="https://pnpm.io/zh/workspaces" target="_blank" rel="noopener noreferrer">workspace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <blockquote><p>pnpm 内置了对单一存储库（也称为多包存储库、多项目存储库或单体存储库）的支持， 你可以创建一个 <code>workspace</code> 以将多个项目合并到一个仓库中。</p> <p>一个 <code>workspace</code> 的根目录下必须有 <code>pnpm-workspace.yaml</code> 文件， 也可能会有 <code>.npmrc</code> 文件。</p></blockquote> <h2 id="什么是-changesets"><a href="#什么是-changesets" class="header-anchor">#</a> 什么是 <a href="https://github.com/changesets/changesets" target="_blank" rel="noopener noreferrer">Changesets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>什么是 <a href="https://github.com/changesets/changesets" target="_blank" rel="noopener noreferrer">changesets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ? 根据官网的介绍 changesets 是用于管理版本及变更日志的工具，专注多包管理。</p> <p><code>Changesets</code> 具有以下几个特点：</p> <ul><li><p>在开发时，需要开发者提供本次变更涉及的包名称、升级版本类型(<code>pathch、minor、major</code>)及变更信息，即 changeset。</p></li> <li><p>在发布版本时，会根据 <code>changeset</code> 自动升级对应包的版本号，并在对应的包中生成 <code>Changelog</code> 信息。</p></li> <li><p>在 <code>Monorepo</code> 场景中，<code>changeset</code> 会自动生成仓库依赖图，升级时只会升级变更包及相关依赖包的版本号。</p></li></ul> <h2 id="为什么要使用-changesets"><a href="#为什么要使用-changesets" class="header-anchor">#</a> 为什么要使用 Changesets</h2> <blockquote><p><code>workspace</code> 中的包版本管理是一个复杂的任务，<code>pnpm</code> 目前也并未提供内置的解决方案。 不过，有两个不错且支持 pnpm 的版本控制工具可以使用：</p> <ul><li><a href="https://github.com/changesets/changesets" target="_blank" rel="noopener noreferrer">changesets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rushjs.io/" target="_blank" rel="noopener noreferrer">Rush<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <h2 id="使用-pnpm-搭建-monorepo-工程"><a href="#使用-pnpm-搭建-monorepo-工程" class="header-anchor">#</a> 使用 pnpm 搭建 monorepo 工程</h2> <h3 id="安装-pnpm"><a href="#安装-pnpm" class="header-anchor">#</a> 安装 pnpm</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> <span class="token function">pnpm</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>v7 版本的 pnpm 安装使用需要 node 版本至少大于 v14.19.0，所以在安装之前首先需要检查下 node 版本。</p></div> <h3 id="工程初始化"><a href="#工程初始化" class="header-anchor">#</a> 工程初始化</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 创建项目目录并进入</span>
<span class="token function">mkdir</span> monorepo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> monorepo
<span class="token comment"># 创建子包目录</span>
<span class="token function">mkdir</span> packages
<span class="token comment"># 初始化项目</span>
<span class="token function">pnpm</span> init
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>根目录 <code>pacakge.json</code> <code>private</code> 防止被发出去</p></div> <h3 id="配置-pnpm-的-workspace"><a href="#配置-pnpm-的-workspace" class="header-anchor">#</a> 配置 pnpm 的 workspace</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#根目录创建配置文件 pnpm-workspace.yaml</span>
<span class="token function">touch</span> pnpm-workspace.yaml
</code></pre></div><p>pnpm-workspace.yaml 内容</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;packages/*&quot;</span>
</code></pre></div><p>配置项目只允许使用 pnpm</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json配置scripts命令钩子</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;preinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npx only-allow pnpm&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>preinstall 脚本会在 install 之前执行，现在，只要有人运行 npm install 或 yarn install，就会调用 only-allow 去限制只允许使用 pnpm 安装依赖。</p></blockquote> <h3 id="配置安装-changesets-init"><a href="#配置安装-changesets-init" class="header-anchor">#</a> 配置安装 changesets （init）</h3> <p>将 changesets 作为开发依赖项安装在工作空间的根目录中：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> <span class="token function">add</span> @changesets/cli <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span>
<span class="token comment"># -w是将依赖安装在最外层根项目</span>
</code></pre></div><p>然后使用 changesets 的初始化命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> changeset init
</code></pre></div><p>当使用初始化命令后 会生成.changeset 文件夹，包含配置文件</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// .changeset/config.json文件</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://unpkg.com/@changesets/config@2.1.1/schema.json&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@changesets/cli/changelog&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fixed&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;linked&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;restricted&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;baseBranch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;updateInternalDependencies&quot;</span><span class="token operator">:</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用添加新的-changesets-add"><a href="#使用添加新的-changesets-add" class="header-anchor">#</a> 使用添加新的 changesets (add)</h3> <p>要生成新的 changesets，请在仓库的根目录中执行<code>pnpm changeset</code>。 <code>.changeset</code> 目录中生成的 <code>markdown</code> 文件需要被提交到到仓库。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> changeset
<span class="token comment">#或者</span>
<span class="token function">pnpm</span> changeset <span class="token function">add</span>
</code></pre></div><p>使用以上命令后，会将此次更新内容与变动暂存在<code>.changeset</code>文件中，等下下次发布变更时进行消耗，可存在多个变更的暂存</p> <h3 id="使用-changeset-发布变更-version"><a href="#使用-changeset-发布变更-version" class="header-anchor">#</a> 使用 changeset 发布变更 （version）</h3> <ol><li>运行 <code>pnpm changeset version</code>。 这将提高先前使用 <code>pnpm changeset</code> （以及它们的任何依赖项）的版本，并更新变更日志文件。</li> <li>运行 <code>pnpm install</code>。 这将更新锁文件并重新构建包。</li> <li>提交更改。</li> <li>运行 <code>pnpm publish -r</code>。 此命令将发布所有包含被更新版本且尚未出现在包注册源中的包。</li></ol> <h3 id="项目工程化相关"><a href="#项目工程化相关" class="header-anchor">#</a> 项目工程化相关</h3> <h4 id="typescript-支持"><a href="#typescript-支持" class="header-anchor">#</a> typescript 支持</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> <span class="token function">add</span> <span class="token parameter variable">-Dw</span> typescript
</code></pre></div><h4 id="eslint-与-prettier-支持"><a href="#eslint-与-prettier-支持" class="header-anchor">#</a> eslint 与 prettier 支持</h4> <p>安装相关依赖</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> <span class="token function">add</span> eslint prettier eslint-plugin-prettier eslint-config-prettier <span class="token parameter variable">-Dw</span>
<span class="token function">pnpm</span> <span class="token function">add</span> @typescript-eslint/eslint-plugin @typescript-eslint/parser  <span class="token parameter variable">-Dw</span>
</code></pre></div><p><strong>配置 eslint</strong></p> <p><code>.eslint.js</code>文件配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//浏览器</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;prettier&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@typescript-eslint&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 内置规则</span>
    <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;linebreak-style&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;windows&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-mixed-spaces-and-tabs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;windows&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-consol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-var&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 不能使用var声明变量</span>
    <span class="token string-property property">&quot;no-extra-semi&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/indent&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;import/extensions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">indent</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">SwitchCase</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// error类型，缩进2个空格</span>
    <span class="token string-property property">&quot;space-before-function-paren&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 在函数左括号的前面是否有空格</span>
    <span class="token string-property property">&quot;eol-last&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 不检测新文件末尾是否有空行</span>
    <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;never&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 在语句后面加分号</span>
    <span class="token string-property property">&quot;no-console&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">allow</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;warn&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 允许使用console.log()</span>
    <span class="token string-property property">&quot;arrow-parens&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-new&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//允许使用 new 关键字</span>
    <span class="token string-property property">&quot;comma-dangle&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;never&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 数组和对象键值对最后一个逗号， never参数：不能带末尾的逗号, always参数：必须带末尾的逗号，always-multiline多行模式必须带逗号，单行模式不能带逗号</span>
    <span class="token string-property property">&quot;no-undef&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>.eslintignore</code>文件配置</p> <div class="language- extra-class"><pre class="language-text"><code>node_mudules/
dist/
lib/
dist
pnpm-lock.yaml
packages/*/dist
packages/*/node_mudules
</code></pre></div><p><strong>配置 prettier</strong></p> <p><code>.prettierignore</code>文件配置</p> <div class="language- extra-class"><pre class="language-text"><code>/node_modules/**
.local
/dist/*
/test/**
/build/*
**/*.svg
lib/
es/
dist/
_site/
coverage/
CNAME
LICENSE
yarn.lock
netlify.toml
yarn-error.log
*.sh
*.snap
.gitignore
.npmignore
.prettierignore
.DS_Store
.editorconfig
.eslintignore
**/*.yml
components/style/color/*.less
**/assets
.gitattributes
.stylelintrc
.vcmrc
.png
.npmrc.template
.huskyrc
.gitmodules
*.png
v2-doc/
</code></pre></div><p><code>.prettierrc.js</code>文件配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="安装-husky-与-commitlint"><a href="#安装-husky-与-commitlint" class="header-anchor">#</a> 安装 husky 与 commitlint</h3> <p>具体操作可看<a href="/myblog/pages/209fb8/">下一篇</a></p> <h2 id="changesets-的使用"><a href="#changesets-的使用" class="header-anchor">#</a> Changesets 的使用</h2> <p>初始化上面已经说过了 这里主要介绍项目的变更与发布</p> <h3 id="changset-的添加"><a href="#changset-的添加" class="header-anchor">#</a> changset 的添加</h3> <p>当项目的某个子项目或者多个发生变更 执行<code>pnpm changeset</code>命令</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> changeset
</code></pre></div><p><img src="/myblog/assets/img/WX20221009-155444@2x.0373f28b.png" alt="changeset"></p> <p>操作界面会列出<strong>改动</strong>与<strong>未改动</strong>的所有子包（子项目） 需要进行选择这次添加内容</p> <p>当选择文件结束 会询问是否是<code>major</code>版本的改动</p> <p><img src="/myblog/assets/img/WX20221009-155746@2x.2e05c8a9.png" alt="changeset"></p> <p>当未做选择 会询问是否是<code>minor</code>版本的改动</p> <p><img src="/myblog/assets/img/WX20221009-155952@2x.33d53606.png" alt="changeset"></p> <p>当未做选择 会自动默认是<code>patch</code>版本的改动</p> <p><img src="/myblog/assets/img/WX20221009-162942@2x.ebddf358.png" alt="changeset"></p> <p>这个时候我们需要填写此次的更改内容描述，这个会用于后续的 changelog 的文件生成</p> <p><img src="/myblog/assets/img/WX20221009-163256@2x.dbee5d40.png" alt="changeset"></p> <p>当设置添加完毕会发现<code>.changeset</code>文件夹新增了一个<code>md</code>文件 这个文件就是暂存的更改记录</p> <p><img src="/myblog/assets/img/WX20221009-163356@2x.88673843.png" alt="changeset"></p> <p>到这个 changset 的添加就算完成了</p> <h3 id="changeset-的发布"><a href="#changeset-的发布" class="header-anchor">#</a> changeset 的发布</h3> <ol><li>运行 <code>pnpm changeset version</code>。 这将提高先前使用 <code>pnpm changeset</code> （以及它们的任何依赖项）的版本，并更新变更日志文件。</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> changeset version
</code></pre></div><p>当执行此文件 会发现相应的子项目会进行<code>package.json</code>文件中的版本更新与生成<code>changelog.md</code>文件</p> <p><img src="/myblog/assets/img/WX20221009-164056@2x.e24f666a.png" alt="changeset"></p> <p>这个时候我们也会发现上面说的生成的随机命名文件<code>sild-experts-drum.md</code>文件消失了（被消耗）</p> <ol start="2"><li><p>运行 <code>pnpm install</code></p> <p>这一步主要是将更新锁文件并重新构建包</p></li> <li><p>提交更改。执行<code>git add . &amp;&amp; pnpm run commit</code></p></li> <li><p>运行 <code>pnpm publish -r</code>。 此命令将发布所有包含被更新版本且尚未出现在包注册源中的包。</p></li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">10/13/2022, 10:32:56 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/myblog/pages/51014f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">webview使用</div></a> <a href="/myblog/pages/209fb8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">husyk+commitlint配置提交代码检查与规范</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/myblog/pages/51014f/" class="prev">webview使用</a></span> <span class="next"><a href="/myblog/pages/209fb8/">husyk+commitlint配置提交代码检查与规范</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="1016875496@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jiang-gary" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Jiang Rui | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.e537f6cf.js" defer></script><script src="/myblog/assets/js/2.1acd9fc1.js" defer></script><script src="/myblog/assets/js/3.3d28f0c8.js" defer></script>
  </body>
</html>
