<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>husyk+commitlint配置提交代码检查与规范 | JR-Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around.">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.318df977.css" as="style"><link rel="preload" href="/myblog/assets/js/app.e537f6cf.js" as="script"><link rel="preload" href="/myblog/assets/js/2.1acd9fc1.js" as="script"><link rel="preload" href="/myblog/assets/js/4.78d7c9d5.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.00af6b8a.js"><link rel="prefetch" href="/myblog/assets/js/11.311509a4.js"><link rel="prefetch" href="/myblog/assets/js/12.c754f8a6.js"><link rel="prefetch" href="/myblog/assets/js/13.4cb3dc3b.js"><link rel="prefetch" href="/myblog/assets/js/14.29c7e94d.js"><link rel="prefetch" href="/myblog/assets/js/15.f46e4d37.js"><link rel="prefetch" href="/myblog/assets/js/16.efaba0c7.js"><link rel="prefetch" href="/myblog/assets/js/17.b69d9adf.js"><link rel="prefetch" href="/myblog/assets/js/3.3d28f0c8.js"><link rel="prefetch" href="/myblog/assets/js/5.f4c66f27.js"><link rel="prefetch" href="/myblog/assets/js/6.d5069eb1.js"><link rel="prefetch" href="/myblog/assets/js/7.28162aa8.js"><link rel="prefetch" href="/myblog/assets/js/8.394493cb.js"><link rel="prefetch" href="/myblog/assets/js/9.deedd640.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.318df977.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">JR-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><!----> <span class="title" style="display:;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/5ea030/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/404" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/51014f/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/" aria-current="page" class="nav-link router-link-exact-active router-link-active">前端工程</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/97fe03/" class="nav-link">前端组件库</a></li></ul></div></div><div class="nav-item"><a href="/myblog/pages/209fb8/404" class="nav-link">工作</a></div><div class="nav-item"><a href="/myblog/pages/209fb8/404" class="nav-link">生活</a></div> <a href="https://github.com/jiang-gary/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><!----> <span class="title" style="display:;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/5ea030/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/404" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/51014f/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/209fb8/" aria-current="page" class="nav-link router-link-exact-active router-link-active">前端工程</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/97fe03/" class="nav-link">前端组件库</a></li></ul></div></div><div class="nav-item"><a href="/myblog/pages/209fb8/404" class="nav-link">工作</a></div><div class="nav-item"><a href="/myblog/pages/209fb8/404" class="nav-link">生活</a></div> <a href="https://github.com/jiang-gary/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>手写系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/5ea030/" class="sidebar-link">实现call,apply,bind</a></li><li><a href="/myblog/pages/db05f4/" class="sidebar-link">实现Promise</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/14dc86/" class="sidebar-link">原型-原型链-继承</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/51014f/" class="sidebar-link">webview使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/a88ea4/" class="sidebar-link">pnpm+workspace+changesets构建monorepo工程</a></li><li><a href="/myblog/pages/209fb8/" aria-current="page" class="active sidebar-link">husyk+commitlint配置提交代码检查与规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/myblog/pages/209fb8/#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/209fb8/#husky-安装与使用" class="sidebar-link">husky 安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_1-项目中安装" class="sidebar-link">1. 项目中安装</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_2-创建-husky-目录并指定该目录为-git-hooks-所在的目录" class="sidebar-link">2. 创建.husky/目录并指定该目录为 git hooks 所在的目录</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_3-添加-git-hooks" class="sidebar-link">3.添加 git hooks</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/209fb8/#commitlint-安装与使用" class="sidebar-link">commitlint 安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_1-在项目中安装" class="sidebar-link">1. 在项目中安装</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_2-添加-commitlint-配置" class="sidebar-link">2.添加 commitlint 配置</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_3-husyk-中添加-commit-msg" class="sidebar-link">3.husyk 中添加 commit-msg</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_4-安装辅助提交依赖-commitizen" class="sidebar-link">4. 安装辅助提交依赖（commitizen）</a></li><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#_5-添加-commitizen-的自定义提示信息" class="sidebar-link">5. 添加 commitizen 的自定义提示信息</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/myblog/pages/209fb8/#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/myblog/pages/209fb8/#常见问题" class="sidebar-link">常见问题</a></li></ul></li></ul></li><li><a href="/myblog/pages/d96e68/" class="sidebar-link">standard-version版本自动化工具</a></li><li><a href="/myblog/pages/d03de6/" class="sidebar-link">前端单元测试</a></li><li><a href="/myblog/pages/1b7d18/" class="sidebar-link">Babel认识与应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端组件库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/97fe03/" class="sidebar-link">搭建Taro3组件库</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-e1efabd0><div class="articleInfo" data-v-e1efabd0><ul class="breadcrumbs" data-v-e1efabd0><li data-v-e1efabd0><a href="/myblog/" title="首页" class="iconfont icon-home router-link-active" data-v-e1efabd0></a></li> <li data-v-e1efabd0><span data-v-e1efabd0>学习</span></li><li data-v-e1efabd0><span data-v-e1efabd0>前端工程</span></li></ul> <div class="info" data-v-e1efabd0><div title="作者" class="author iconfont icon-touxiang" data-v-e1efabd0><a href="https://github.com/jiang-gary" target="_blank" title="作者" class="beLink" data-v-e1efabd0>Jiang Rui</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-e1efabd0><a href="javascript:;" data-v-e1efabd0>2022-09-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">husyk+commitlint配置提交代码检查与规范<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>在团队多人开发中，规范的 commit message 可以快速定位代码提交历史，回溯问题根源，方便组内多人协作，提高团队效率。</p> <h2 id="husky-安装与使用"><a href="#husky-安装与使用" class="header-anchor">#</a> husky 安装与使用</h2> <h3 id="_1-项目中安装"><a href="#_1-项目中安装" class="header-anchor">#</a> 1. 项目中安装</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i lint-staged <span class="token parameter variable">-D</span>  <span class="token comment"># 安装lint-staged</span>
<span class="token function">npm</span> i husky <span class="token parameter variable">-D</span>  <span class="token comment"># 安装husky</span>
<span class="token comment"># 或者</span>
<span class="token function">pnpm</span> <span class="token function">add</span> lint-staged husky <span class="token parameter variable">-D</span>
</code></pre></div><h3 id="_2-创建-husky-目录并指定该目录为-git-hooks-所在的目录"><a href="#_2-创建-husky-目录并指定该目录为-git-hooks-所在的目录" class="header-anchor">#</a> 2. 创建.husky/目录并指定该目录为 git hooks 所在的目录</h3> <p>在 pacakge.json 中添加<code>prepare</code>脚本</p> <ul><li><p>使用命令的方式添加</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> set-script prepar <span class="token string">&quot;husky install&quot;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>命名方式添加需要<code>npm</code>版本在 7.x+</p></div></li> <li><p>手动在 package.json 中添加</p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>prepare 脚本会在执行 npm install 之后自动执行。也就是说当我们执行 npm install 安装完项目依赖后会执行 husky install 命令。</p></blockquote> <p>添加好脚本命令后 初始化 husky</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run prepare <span class="token comment"># 初始化husky,将 git hooks 钩子交由,husky执行</span>
</code></pre></div><h3 id="_3-添加-git-hooks"><a href="#_3-添加-git-hooks" class="header-anchor">#</a> 3.添加 git hooks</h3> <p>创建一条<code>pre-commit hook</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/pre-commit <span class="token string">&quot;npx lint-staged&quot;</span>
</code></pre></div><p>执行命令后 <code>.husky/</code>目录下新增一个名为<code>pre-commit</code>的 shell 脚本
在知道后执行<code>git commit</code>命令的时候就会执行这条脚本</p> <p>生成的 shell 脚本如下(<strong>自动生成</strong>)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env sh</span>
<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> -- <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">)</span></span>/_/husky.sh&quot;</span>

npx lint-staged

</code></pre></div><p>执行当前脚本后，会执行当前命令<code>npx lint-staged</code>
所以需要配置<code>lint-staged</code>的配置文件</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>可通过根目录添加.lintstagedrc.json 文件</p> <p>可通过在 package.json 中添加</p></div> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> .lintstagedrc.json <span class="token comment"># 根目录添加lint-staged的配置文件</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// .lintstagedrc.json示例</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;*.{js,jsx,ts,tsx}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;prettier --write .&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;eslint  --fix&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;*.md&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述示例中的配置就是进行 js、ts 等文件格式的代码<code>prettier</code>格式化与<code>eslint</code></p> <h2 id="commitlint-安装与使用"><a href="#commitlint-安装与使用" class="header-anchor">#</a> commitlint 安装与使用</h2> <h3 id="_1-在项目中安装"><a href="#_1-在项目中安装" class="header-anchor">#</a> 1. 在项目中安装</h3> <p>安装<code>commitlint</code>用于<code>commit</code>操作的规范检测
安装<code>@commitlint/config-conventional</code>用于<code>commitlint</code>的一个检测标准</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i @commitlint/cli @commitlint/config-conventional <span class="token parameter variable">-D</span>
<span class="token comment"># 或者</span>
<span class="token function">pnpm</span> <span class="token function">add</span> @commitlint/cli @commitlint/config-conventional <span class="token parameter variable">-D</span>
</code></pre></div><h3 id="_2-添加-commitlint-配置"><a href="#_2-添加-commitlint-配置" class="header-anchor">#</a> 2.添加 commitlint 配置</h3> <p>根目录创建<code>commitlint.config.js</code>配置文件 并写入规则 使用<code>@commitlint/config-conventional</code>规则</p> <blockquote><p><code>@commitlint/config-conventional</code> 这是一个规范配置,标识采用什么规范来执行消息校验, 这个默认是 Angular 的提交规范</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;module.exports = {extends: ['@commitlint/config-conventional']}&quot;</span> <span class="token operator">&gt;</span> commitlint.config.js
</code></pre></div><h3 id="_3-husyk-中添加-commit-msg"><a href="#_3-husyk-中添加-commit-msg" class="header-anchor">#</a> 3.husyk 中添加 commit-msg</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">'npx --no-install commitlint --edit &quot;$1&quot;'</span>
</code></pre></div><p>执行命令后 <code>.husky/</code>目录下新增一个名为<code>commit-msg</code>的 shell 脚本</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// commit-msg脚本内容</span>
#!/usr/bin/env sh
. <span class="token string">&quot;$(dirname -- &quot;</span>$<span class="token number">0</span><span class="token string">&quot;)/_/husky.sh&quot;</span>

npx --no-install commitlint --edit <span class="token string">&quot;$1&quot;</span>
</code></pre></div><p>当执行<code>git commit</code>命令提交<code>commit-msg</code>就会触发 <code>git hook</code> 并执行上述脚本</p> <p>上述脚本执行就会就行 commitlint 的校验（校验规则就是<code>@commitlint/config-conventional</code>）</p> <div class="custom-block tip"><p class="custom-block-title">测试</p> <p>添加以上<code>git hook</code>后我们可以来进行一个测试 随意提交一个<code>commit-msg</code></p> <p>填写的<code>commit-msg</code>为<code>'commit-msg test'</code>没能通过规则 无法进行<code>git</code>提交</p></div> <p><img src="/myblog/assets/img/commitlint.80c50509.png" alt="commitlint-img"></p> <h3 id="_4-安装辅助提交依赖-commitizen"><a href="#_4-安装辅助提交依赖-commitizen" class="header-anchor">#</a> 4. 安装辅助提交依赖（commitizen）</h3> <p>当有了 commitlint 检查提交规范 如果手动提交就比较麻烦 这里就可以借助工具<code>commitizen</code></p> <p><a href="http://commitizen.github.io/cz-cli/" target="_blank" rel="noopener noreferrer">commitizen 官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>Simple commit conventions for internet citizens.</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i commitizen cz-conventional-changelog <span class="token parameter variable">-D</span>  <span class="token comment"># 安装commitizen依赖</span>
<span class="token comment"># 或者</span>
<span class="token function">pnpm</span> <span class="token function">add</span> commitizen cz-conventional-changelog <span class="token parameter variable">-D</span>
</code></pre></div><p>安装好相关依赖后 需要在<code>package.json</code>进行配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cz&quot;</span>  <span class="token comment">// 添加提交指令 使用cz提交</span>
    <span class="token punctuation">}</span>
    <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cz-conventional-changelog&quot;</span> <span class="token comment">// 使用这个依赖提供的预设</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">测试</p> <p>当依赖安装好并且进行了以上配置 就可以运行<code>npm run commit</code>进行测试</p></div> <p>使用<code>cz</code>进行提交 会出现选项供我们选择</p> <p><img src="/myblog/assets/img/cz.ad4a6dc6.png" alt="cz"></p> <p>当此次提交类型选定后 就需要填写本次提交的短描述与长描述等相关信息</p> <p><img src="/myblog/assets/img/cz1.7e2c2dbe.png" alt="cz"></p> <h3 id="_5-添加-commitizen-的自定义提示信息"><a href="#_5-添加-commitizen-的自定义提示信息" class="header-anchor">#</a> 5. 添加 commitizen 的自定义提示信息</h3> <p>安装<code>cz-customizable</code>,安装这个依赖后就可以自定义提示内容 可以自定义中文或者加上一些 emoji</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i cz-customizable <span class="token parameter variable">-D</span>
<span class="token comment"># 或者</span>
<span class="token function">pnpm</span> <span class="token function">add</span> cz-customizable <span class="token parameter variable">-D</span>
</code></pre></div><p>当<code>cz-customizable</code>安装好之后 就需要在<code>packgae.json</code>中的<code>commitizen</code>配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/cz-customizable&quot;</span> <span class="token comment">// 将提示信息依赖修改成cz-customizable</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>经过上面的配置 就可以自定义提示信息了</p> <p>这就需要新增一个自定义内容文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> .cz-config.js
</code></pre></div><p><code>.cz-config.js</code>文件就是用来自定义提示信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .cz-config.js 示例</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">allowBreakingChanges</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;feat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fix&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">allowCustomScopes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">scopes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;功能：新增功能，迭代项目需求 (feat)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;feat&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;修复：修复缺陷，修复上一版本存在问题 (fix)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;fix&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;文档：更新文档，仅改动文档不改动代码 (docs)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;docs&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;样式：变动格式，不影响代码逻辑 (style)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;重构：重构代码，非新增功能也非修改缺陷 (refactor)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;refactor&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;性能：优化性能，提高代码执行性能 (perf)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;perf&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;测试：新增测试，追加测试用例验证代码 (test)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;构建：更新构建，改动构建工具或外部依赖 (build)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;脚本：更新脚本，改动CI或执行脚本配置 (ci)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;ci&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;事务：变动事务，改动其他不影响代码的事务 (chore)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;chore&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;回滚：回滚版本，撤销某次代码提交 (revert)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;revert&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;合并：合并分支，合并分支代码到其他分支 (merge)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;merge&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;同步：同步分支，同步分支代码到其他分支 (sync)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;sync&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;改进：改进功能，升级当前功能模块 (impr)&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;impr&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">测试</p> <p>自定义提示配置好了 我们可以尝试<code>npm run commit</code>提交一下</p> <p>就可以看到我们自定义的提示内容设置成功了</p></div> <p><img src="/myblog/assets/img/cz3.aedee270.png" alt="cz3"></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> <strong>总结</strong></h2> <p>其实到这里应该可以结束了 但是可能会遇到一些常见问题</p> <h3 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h3> <ol><li>自定义的提示信息 提交为什么无法通过 <code>commitlint</code> 校验？</li></ol> <p>由于我们自定义了提示信息和规则 这时候可能就没办法通过<code>@commitlint/config-conventional</code>的校验</p> <p>这个时候我们就需要安装<code>commitlint-config-cz</code> 让<code>commitlint</code>使用<code>cz</code>的规范</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i commitlint-config-cz <span class="token parameter variable">-D</span>
<span class="token comment"># 或者</span>
<span class="token function">pnpm</span> <span class="token function">add</span> commitlint-config-cz <span class="token parameter variable">-D</span>
</code></pre></div><p>当安装好依赖后 需要修改<code>.commitlintrc.js</code>文件夹</p> <div class="language-json extra-class"><pre class="language-json"><code>module.exports = <span class="token punctuation">{</span>
  <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cz&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 这里可以配置规则 类似于eslint的配置</span>
<span class="token punctuation">}</span>;

</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">9/6/2022, 4:32:53 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/myblog/pages/a88ea4/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">pnpm+workspace+changesets构建monorepo工程</div></a> <a href="/myblog/pages/d96e68/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">standard-version版本自动化工具</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/myblog/pages/a88ea4/" class="prev">pnpm+workspace+changesets构建monorepo工程</a></span> <span class="next"><a href="/myblog/pages/d96e68/">standard-version版本自动化工具</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="1016875496@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jiang-gary" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Jiang Rui | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.e537f6cf.js" defer></script><script src="/myblog/assets/js/2.1acd9fc1.js" defer></script><script src="/myblog/assets/js/4.78d7c9d5.js" defer></script>
  </body>
</html>
